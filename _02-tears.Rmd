# Reading in Labelled Data: Stata

The first step to working with labeled data in R is loading a labeled data file, and making sure the labels are attached. Several of the packages in [Labelling Packages] have functions for loading labeled data while others have functions checking for labels. A few packages do both. The first table shows which packages read .dta files into R and their functions that do so. The second table shows which packages allow you to checkout the labels of the loaded data.

+---------------+--------------------------------+
| Package       | Function for loading .dta file |
+===============+================================+
| `haven`       | `read_dta()`                   |
+---------------+--------------------------------+
| `sjlabelled`  | `read_stata()`                 |
+---------------+--------------------------------+
| `foreign`     | `read.dta()` Up to 12          |
+---------------+--------------------------------+
| `readstata13` | `read.dta13()` Past 12         |
+---------------+--------------------------------+
Table: Functions to read in Stata data


+---------------+------------------+---------------------+-------------------+
| Package       |  Labels Exist    | View Variable Label | View Value Labels |
+===============+=+================+=====================+===================+
| `labelled`    | `is.labelled()`  | `var_label()`       | `val_labels()`    |
+---------------+------------------+---------------------+-------------------+
| `sjlabelled`  | `is_labelled()`  | `get_label()`       | `get_labels()`    |
+---------------+------------------+---------------------+-------------------+
| `expss`       | `is.labelled()`  | `var_lab()`         | `val_lab()`       |
+---------------+------------------+---------------------+-------------------+
| `readstata13` |  N/A             | `varlabel()`        | `get.label()`     |
+---------------+------------------+---------------------+-------------------+
Table: Functions to look at labels

This chapter is organized as follows. Each section reads in .dta files according to a package: `haven`, `sjlabelled`, and `readstata13`. The `foreign` package is not covered because it is not updated for Stata files. Once the data is loaded, we look at the class of the data as well as the class and structure of a variable that *should* be labeled (hint: not all packages retain labels of the data). There are two data sets being read into R: the City Temp data that is included as example data in Stata, and the publicly available Arab Barometer Wave VII data^[which can be found [here](https://www.arabbarometer.org/survey-data/data-downloads/)]. The City Temp data was created in Stata, while the Arab Barometer Wave VII data was created in R, labeled in SPSS, and saved as a .dta file using the `haven` package.

Each section has a subsection that fills in the table of functions to look at labels. That is, a variable that should be labeled is passed into the function in the table and TRUE, FALSE, or ERROR is recorded in the table as a result. A FALSE result means labels should appear, but the function returns NULL. A ERROR result means even if the function is given proper syntax, an error occurs. This happens mostly commonly when the data is not of an appropriate class for the function.


## Loading .dta file with `haven`

```{r haven-loading-dta}

CityTemp_haven <- haven::read_dta("CityTemp.dta")

class(CityTemp_haven)
attributes(CityTemp_haven$division)
str(CityTemp_haven$division)


```



### Checking labels of `haven` loaded data


```{r haven-loaded-labels-CT}
# City Data
## Labels Exist?
haven::is.labelled(CityTemp_haven$division)
sjlabelled::is_labelled(CityTemp_haven$division)
expss::is.labelled(CityTemp_haven$division)



## View Labels
labelled::var_label(CityTemp_haven$division)
labelled::val_labels(CityTemp_haven$division)

sjlabelled::get_label(CityTemp_haven$division)
sjlabelled::get_labels(CityTemp_haven$division)

expss::var_lab(CityTemp_haven$division)
expss::val_lab(CityTemp_haven$division)

readstata13::varlabel(CityTemp_haven,"division")
readstata13::get.label(CityTemp_haven,"division")
```


+---------------+------------------+---------------------+-------------------+
| Package       |  Labels Exist    | View Variable Label | View Value Labels |
+===============+=+================+=====================+===================+
| `labelled`    | TRUE             | TRUE                | TRUE              |
+---------------+------------------+---------------------+-------------------+
| `sjlabelled`  | TRUE             | TRUE                | TRUE              |
+---------------+------------------+---------------------+-------------------+
| `expss`       | FALSE            | TRUE                | TRUE              |
+---------------+------------------+---------------------+-------------------+
| `readstata13` |  N/A             | ERROR               | FALSE             |
+---------------+------------------+---------------------+-------------------+






## Loading .dta file with `sjlabelled`

```{r sjlabelled-loading-dta}

CityTemp_sjlabelled <- sjlabelled::read_stata("CityTemp.dta")

class(CityTemp_sjlabelled)
attributes(CityTemp_sjlabelled$division)
str(CityTemp_sjlabelled$division)

```


### Checking labels of `sjlabelled` loaded data


```{r sjlabelled-loaded-labels-CT}
# City Data
## Labels Exist?

haven::is.labelled(CityTemp_sjlabelled$division)
sjlabelled::is_labelled(CityTemp_sjlabelled$division)
expss::is.labelled(CityTemp_sjlabelled$division)


## View Labels
labelled::var_label(CityTemp_sjlabelled$division)
labelled::val_labels(CityTemp_sjlabelled$division)

sjlabelled::get_label(CityTemp_sjlabelled$division)
sjlabelled::get_labels(CityTemp_sjlabelled$division)

expss::var_lab(CityTemp_sjlabelled$division)
expss::val_lab(CityTemp_sjlabelled$division)

readstata13::varlabel(CityTemp_sjlabelled,"division")
readstata13::get.label(CityTemp_sjlabelled,"division")

```


+---------------+------------------+---------------------+-------------------+
| Package       |  Labels Exist    | View Variable Label | View Value Labels |
+===============+=+================+=====================+===================+
| `labelled`    | TRUE             | TRUE                | TRUE              |
+---------------+------------------+---------------------+-------------------+
| `sjlabelled`  | TRUE             | TRUE                | TRUE              |
+---------------+------------------+---------------------+-------------------+
| `expss`       | FALSE            | TRUE                | TRUE              |
+---------------+------------------+---------------------+-------------------+
| `readstata13` |  N/A             | ERROR               | FALSE             |
+---------------+------------------+---------------------+-------------------+




## Loading .dta file with `readstata13`


```{r readstata13-loading-CT}

CityTemp_readstata13 <- readstata13::read.dta13("CityTemp.dta")

class(CityTemp_readstata13)
class(CityTemp_readstata13$division)

```


### Checking labels of `readstata13` loaded data

```{r readstata13-loaded-label-checks-CT}
# Labels Exist?
haven::is.labelled(CityTemp_readstata13$division)
sjlabelled::is_labelled(CityTemp_readstata13$division)
expss::is.labelled(CityTemp_readstata13$division)

# View Labels
labelled::var_label(CityTemp_readstata13$division)
labelled::val_labels(CityTemp_readstata13$division)

sjlabelled::get_label(CityTemp_readstata13$division)
sjlabelled::get_labels(CityTemp_readstata13$division)

expss::var_lab(CityTemp_readstata13$division)
expss::val_lab(CityTemp_readstata13$division)

readstata13::get.label.name(CityTemp_readstata13)
readstata13::get.label(CityTemp_readstata13)


```


+---------------+------------------+---------------------+-------------------+
| Package       |  Labels Exist    | View Variable Label | View Value Labels |
+===============+=+================+=====================+===================+
| `labelled`    | FALSE            | FALSE               | FALSE             |
+---------------+------------------+---------------------+-------------------+
| `sjlabelled`  | FALSE            | FALSE               | TRUE              |
+---------------+------------------+---------------------+-------------------+
| `expss`       | FALSE            | FALSE               | FALSE             |
+---------------+------------------+---------------------+-------------------+
| `readstata13` |  N/A             | TRUE                | TRUE              |
+---------------+------------------+---------------------+-------------------+


## City Temp Data
### Variable Labels
+---------------------------------+-------------------------+---------------------------+--------------------+-------------------------+
| City Temp Data                  | `labelled::var_label()` | `sjlabelled::get_label()` | `expss::var_lab()` | `readstata13::varlab()` |
+=================================+=========================+===========================+====================+=========================+
| `haven::read_dta()`             | TRUE                    | TRUE                      | TRUE               | FRROR                   |
+---------------------------------+-------------------------+---------------------------+--------------------+-------------------------+
| `sjlabelled::read_stata()`      | TRUE                    | TRUE                      | TRUE               | ERROR                   |
+---------------------------------+-------------------------+---------------------------+--------------------+-------------------------+
| `readstata13::read.dta13()`, V1 | FALSE                   | FALSE                     | FALSE              | FALSE                   |
+---------------------------------+-------------------------+---------------------------+--------------------+-------------------------+
| `readstata13::read.dta13()`, V2 | FALSE                   | FALSE                     | FALSE              | TRUE                    |
+---------------------------------+-------------------------+---------------------------+--------------------+-------------------------+

### Value Labels
+---------------------------------+--------------------------+----------------------------+--------------------+----------------------------+
| City Temp Data                  | `labelled::val_labels()` | `sjlabelled::get_labels()` | `expss::val_lab()` | `readstata13::get.label()` |
+=================================+==========================+============================+====================+============================+
| `haven::read_dta()`             | FALSE                    | TRUE                       | TRUE               | FALSE                      |
+---------------------------------+--------------------------+----------------------------+--------------------+----------------------------+
| `sjlabelled::read_stata()`      | FALSE                    | TRUE                       | TRUE               | FALSE                      |
+---------------------------------+--------------------------+----------------------------+--------------------+----------------------------+
| `readstata13::read.dta13()`, V1 | FALSE                    | FALSE                      | FALSE              | FALSE                      |
+---------------------------------+--------------------------+----------------------------+--------------------+----------------------------+
| `readstata13::read.dta13()`, V2 | FALSE                    | TRUE                       | FALSE              | TRUE                       |
+---------------------------------+--------------------------+----------------------------+--------------------+----------------------------+

