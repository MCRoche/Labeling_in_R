# Reading in Labelled Data


```{r drive-data-path,echo=FALSE}

path_to_dta <- "/Volumes/GoogleDrive/Shared drives/Arab Barometer/AB7/Data/RELEASE_DATA/Latest/AB7_ENG_Release_Version6.dta"
path_to_sav <- "/Volumes/GoogleDrive/Shared drives/Arab Barometer/AB7/Data/RELEASE_DATA/Latest/AB7_ENG_Release_Version6.sav"

```

## Loading .dta files

### Loading .dta file with `haven`

```{r haven-loading-dta}

pd_haven_dta <- haven::read_dta(path_to_dta)

class(pd_haven_dta)
class(pd_haven_dta$Q1COVID19)

```


### Loading .dta file with `sjlabelled`

```{r sjlabelled-loading-dta}

pd_sjlabelled_dta <- sjlabelled::read_stata(path_to_dta)

class(pd_sjlabelled_dta)
class(pd_sjlabelled_dta$Q1COVID19)

```





### Loading .dta file with `readstata13`

```{r readstata13-loading-dta-v1}

pd_readstata13_dta_v1 <- readstata13::read.dta13(path_to_dta)

warnings()[1]

class(pd_readstata13_dta_v1)
class(pd_readstata13_dta_v1$Q1COVID19)

```

This dta file was created in R for Stata using `haven`. The data was stored as doubles with labels attached. The package `haven` does not compress data when writing dta files. If this was created in Stata, the data would have been stored as bytes, or compressed when saving. As such, `readstata13::read.dta13()` does not attach the labels to the data and only provides numeric values.

The warning message suggests setting the parameter `nonint.factors` to `TRUE`, so let's see what happens then.

```{r readstata13-loading-dta-v2}

pd_readstata13_dta_v2 <- readstata13::read.dta13(path_to_dta,
                                                 nonint.factors = TRUE)
warnings()[1:2]

class(pd_readstata13_dta_v2)
class(pd_readstata13_dta_v2$Q1COVID19)

```

There are far fewer warnings, and they have to do with missing or duplicated labels, not a lack thereof. You can also see the class of `pd_readstata13_dta_v2$Q1COVID19` is `"factor"` instead of `"numeric"`. Factors can be strings of numeric or alphabetic characters, so let's see what the variable looks like.


```{r compare-v1-v2}

table(pd_readstata13_dta_v1$Q1COVID19)
table(pd_readstata13_dta_v2$Q1COVID19)

```

For version 2, the labels associated with the file are now the factors. If the data was saved with the `haven` package, the `readstata13` package is not the best option to read it into R until the `haven` package adds a compression method. 

## Loading .sav files

### Loading .sav file with haven
```{r haven-loading-sav}

public_data_sav <- haven::read_sav(path_to_sav)

class(public_data_sav)
class(public_data_sav$Q1COVID19)

```

### Loading .sav file with `sjlabelled`

```{r sjlabelled-loading-sav}

pd_sjlabelled_sav <- sjlabelled::read_spss(path_to_sav)

class(pd_sjlabelled_sav)
class(pd_sjlabelled_sav$Q1COVID19)

```


### Loading .sav file with `expss`

```{r expss-loading-sav}

pd_expss_sav <- expss::read_spss(path_to_sav)

class(pd_expss_sav)
class(pd_expss_sav$Q1COVID19)

```