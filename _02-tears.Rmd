# Reading in Labelled Data: Stata

The first step to working with labeled data in R is loading a labeled data file, and making sure the labels are attached. Several of the packages in [Labelling Packages] have functions for loading labeled data while others have functions checking for labels. A few packages do both. See the table below to see the functionality of each package with respect to loading labeled data and checking for labels.

+---------------+------------+-------------------+-------------+
| Package       | Loads .dta | Checks for Labels | View Labels |
+===============+============+===================+=============+
| `haven`       | Yes        | Yes$^*$           | No          |
+---------------+------------+-------------------+-------------+
| `labelled`    | No         | Yes$^*$           | Yes         |
+---------------+------------+-------------------+-------------+
| `sjlabelled`  | Yes        | Yes               | Yes         |
+---------------+------------+-------------------+-------------+
| `expss`       | No         | Yes               | Yes         |
+---------------+------------+-------------------+-------------+
| `foreign`     | Up to 12   | No                | No          |
+---------------+------------+-------------------+-------------+
| `readstata13` | Past 12    | No                | Yes         |
+---------------+------------+-------------------+-------------+
| `Hmisc`       | No         | No                | Yes         |
+---------------+------------+-------------------+-------------+


$^*$The function used to check for labels in the `haven` and `labelled` packages is the same.



This page uses the publicly available Arab Barometer Wave VII data, which can be found [here](https://www.arabbarometer.org/survey-data/data-downloads/). The Arab Barometer data is available labeled in both Stata and SPSS files.


```{r drive-dta-path,echo=FALSE}

path_to_dta <- "/Volumes/GoogleDrive/Shared drives/Arab Barometer/AB7/Data/RELEASE_DATA/Latest/AB7_ENG_Release_Version6.dta"


```

## Loading .dta files

### Loading .dta file with `haven`

```{r haven-loading-dta}

AB7_haven_dta <- haven::read_dta(path_to_dta)

class(AB7_haven_dta)
class(AB7_haven_dta$Q101)

```



### Loading .dta file with `sjlabelled`

```{r sjlabelled-loading-dta}

AB7_sjlabelled_dta <- sjlabelled::read_stata(path_to_dta)

class(AB7_sjlabelled_dta)
class(AB7_sjlabelled_dta$Q101)

```

### Loading .dta file with `readstata13`

```{r readstata13-loading-dta-v1,warning=FALSE}

AB7_readstata13_dta_v1 <- readstata13::read.dta13(path_to_dta)

#warnings()[1]

class(AB7_readstata13_dta_v1)
class(AB7_readstata13_dta_v1$Q101)

```

This dta file was created in R for Stata using `haven`. The data was stored as doubles with labels attached. The package `haven` does not compress data when writing dta files. If this was created in Stata, the data would have been stored as bytes, or compressed when saving. As such, `readstata13::read.dta13()` does not attach the labels to the data and only provides numeric values.

The warning message suggests setting the parameter `nonint.factors` to `TRUE`, so let's see what happens then.

```{r readstata13-loading-dta-v2,warning=FALSE}

AB7_readstata13_dta_v2 <- readstata13::read.dta13(path_to_dta,
                                                 nonint.factors = TRUE)
warnings()[1:2]

class(AB7_readstata13_dta_v2)
class(AB7_readstata13_dta_v2$Q101)

```

There are far fewer warnings, and they have to do with missing or duplicated labels, not a lack thereof. You can also see the class of `AB7_readstata13_dta_v2$Q101` is `"factor"` instead of `"numeric"`. Factors can be strings of numeric or alphabetic characters, so let's see what the variable looks like.

```{r compare-v1-v2}

table(AB7_readstata13_dta_v1$Q101)
table(AB7_readstata13_dta_v2$Q101)

```

For version 2, the labels associated with the file are now the factors. If the data was saved with the `haven` package, the `readstata13` package is not the best option to read it into R until the `haven` package adds a compression method.

## Checks for Labels

### `haven` loaded
```{r haven-loaded-label-checks}

haven::is.labelled(AB7_haven_dta$Q101)
sjlabelled::is_labelled(AB7_haven_dta$Q101)
expss::is.labelled(AB7_haven_dta$Q101)

```


### `sjlabelled` loaded
```{r sjlabelled-loaded-label-checks}

haven::is.labelled(AB7_sjlabelled_dta$Q101)
sjlabelled::is_labelled(AB7_sjlabelled_dta$Q101)
expss::is.labelled(AB7_sjlabelled_dta$Q101)

```